---
scaffold: post
title: MySQL事务（一）
date: 2022-03-21 19:29:02
categories: MySQL
tags:
 - MySQL
 - 事务
 - 事务隔离级别
---

## 事务特性
### 原子性
事务内的多个操作是不可分割的一部分。要么全部被执行成功，要么全部不执行。

### 一致性
事务的一致性使得数据库从一种正确的状态，转换为另一种正确的状态。
例如 银行账户A和B，A向B执行一次转账操作的前后，AB两个账户的总余额应该是始终一致的。

### 隔离性
事务在被正确提交之前，不允许该事务将其对数据的变更传递给其他事务。
也即其他事务在该事务被正确提交之前，不允许感知到该事务对数据的变更。

### 持久性
事务一旦提交，其结果将永久保存在数据库中。即使后续数据库发生了故障，事务的处理结果也会得到正确保存。

## 并发事务带来的问题
### 脏读
> 事务A读到了事务B未提交的数据，后续由于事务B的回滚，导致A读的数据为脏数据。

事务A读取数据前，事务B修改了数据但是没提交事务，此时事务A读取到了B修改未提交的数据。之后事务B因某些原因再次修改数据或回滚数据，导致事务A获取到的是被事务B丢弃掉的数据，称之为脏读。

### 不可重复读
> 在一个事务里面执行两次以上读操作，得到的结果不一致。

事务A在两次读操作的时间区间内，事务B修改了该数据并提交事务，导致A两次读取结果不一致。

### 幻读

> 在一个事务里面的操作中，发现了未被操作的数据

事务A按条件修改了一批数据，提交后发现有几条数据没有被修改。原因是在A事务处理的过程中，B向条件区间内插入了几条数据。

## 事务隔离级别

### 读未提交
当前事务可以读到其他事务没有提交的数据修改。

### 读已提交
当前事务可以读到其他事务已经提交的数据修改。

### 可重复读
当前事务执行中多次读取数据得到的结果是一致的。

### 串行化
所有事物排队串行执行，可以解决所有并发事务的问题，但是性能极低。

## 隔离级别存在的问题

|  #   |  脏读   | 不可重复读 |  幻读   |
|:----:|:-----:|:-----:|:-----:|
| 读未提交 |   √   |   √   |   √   |
| 读已提交 |   ×   |   √   |   √   |
| 可重复读 |   ×   |   ×   |   √   | 
| 串行化  |   ×   |   ×   |   ×   |

